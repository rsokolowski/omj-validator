{% extends "base.html" %}

{% block title %}{{ year }} {{ etap }} - OMJ Validator{% endblock %}

{% block content %}
<nav class="breadcrumb">
    <a href="/years">Lata</a>
    <span class="separator">/</span>
    <a href="/years/{{ year }}">{{ year }}</a>
    <span class="separator">/</span>
    <span class="current">
        {% if etap == "etap1" %}Etap I{% elif etap == "etap2" %}Etap II{% elif etap == "etap3" %}Finał{% else %}{{ etap }}{% endif %}
    </span>
</nav>

<div class="page-header">
    <h1>{{ year }} - {% if etap == "etap1" %}Etap I (szkolny){% elif etap == "etap2" %}Etap II (okręgowy){% elif etap == "etap3" %}Finał{% else %}{{ etap }}{% endif %}</h1>
    <p class="subtitle">Wybierz zadanie do rozwiązania</p>
</div>

<div class="tasks-list">
    {% for task in tasks %}
    <a href="/task/{{ year }}/{{ etap }}/{{ task.number }}" class="task-card {% if not task.has_content %}task-unavailable{% endif %}">
        <div class="task-header">
            <span class="task-number">Zadanie {{ task.number }}</span>
            {% if is_authenticated and task.submission_count > 0 %}
            <span class="task-badge">{{ task.submission_count }} {% if task.submission_count == 1 %}próba{% elif task.submission_count < 5 %}próby{% else %}prób{% endif %}</span>
            {% endif %}
        </div>
        <div class="task-title math-content">{{ task.title }}</div>
        <div class="task-meta-row">
            {% if task.difficulty %}
            <span class="difficulty difficulty-{{ task.difficulty }}"
                  data-tooltip="{{ {1: 'Bardzo łatwe', 2: 'Łatwe', 3: 'Średnie', 4: 'Trudne', 5: 'Bardzo trudne'}[task.difficulty] }}">
                {% for i in range(task.difficulty) %}★{% endfor %}{% for i in range(5 - task.difficulty) %}☆{% endfor %}
            </span>
            {% endif %}
            {% if task.categories %}
            {% for cat in task.categories %}
            <span class="category-badge category-badge-small category-{{ cat }}">
                {{ {'algebra': 'Algebra', 'geometria': 'Geometria', 'teoria_liczb': 'Teoria liczb', 'kombinatoryka': 'Kombinatoryka', 'logika': 'Logika', 'arytmetyka': 'Arytmetyka'}[cat] }}
            </span>
            {% endfor %}
            {% endif %}
        </div>
        {% if is_authenticated %}
        <div class="task-stats">
            {% if task.submission_count > 0 %}
            <span class="stat">
                <span class="stat-label">Najwyższy wynik:</span>
                <span class="stat-value score-{{ task.highest_score }}">{{ task.highest_score }}/6</span>
            </span>
            {% else %}
            <span class="stat stat-empty">Brak prób</span>
            {% endif %}
        </div>
        {% endif %}
    </a>
    {% endfor %}
</div>
{% endblock %}
